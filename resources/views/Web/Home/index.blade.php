<x-web.app-web>
    <section class="history-section padding-tb">
        <div class="col-12">
            <div class="achievement text-center mt-lg-0">
                <div class="achievement-title">
                    <h5>Bersama menghijaukan bumi</h5>
                </div>
                <div class="achievement-content">
                    <div class="row justify-content-center">
                        <div class="col-md-3 mt-5">
                            <div class="lab-item">
                                <div class="lab-inner text-center">
                                    <div class="lab-thumb mb-3">
                                        <img src="{{ url('/') }}/assets-web2/assets/images/about/history/achievement/holding-hand.png"
                                            alt="Customer">
                                    </div>
                                    <div class="lab-content">
                                        <h3><span>{{ $total_pohon_tertanam }}</span></h3>
                                        <p style="color:grey;">Pohon tertanam</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 mt-5">
                            <div class="lab-item">
                                <div class="lab-inner text-center">
                                    <div class="lab-thumb mb-3">
                                        <img src="{{ url('/') }}/assets-web2/assets/images/about/history/achievement/tree.png"
                                            alt="Customer">
                                    </div>
                                    <div class="lab-content">
                                        <h3><span>{{ $total_pohon_hidup }}</span></h3>
                                        <p style="color:grey;">Pohon yang tumbuh</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 mt-5">
                            <div class="lab-item">
                                <div class="lab-inner text-center">
                                    <div class="lab-thumb mb-3">
                                        <img src="{{ url('/') }}/assets-web2/assets/images/about/history/achievement/event.png"
                                            alt="Customer">
                                    </div>
                                    <div class="lab-content">
                                        <h3><span>{{ $eventMendatang }}</span></h3>
                                        <p style="color:grey;">Event mendatang</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 mt-5">
                            <div class="lab-item">
                                <div class="lab-inner text-center">
                                    <div class="lab-thumb mb-3">
                                        <img src="{{ url('/') }}/assets-web2/assets/images/about/history/achievement/calendar.png"
                                            alt="Customer">
                                    </div>
                                    <div class="lab-content">
                                        <h3><span>{{ $eventBerlalu }}</span></h3>
                                        <p style="color:grey;">Event berlalu</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {{-- <section class="nilai-utama">
        <div class="shop-page" style="margin-bottom:100px">
            <div class="container">
                <div class="section-wrapper">
                    <div class="row justify-content-center">
                        <h3>
                            Nilai Utama Kami
                        </h3>
                        <div class="col-lg-12 col-12">
                            <div class="swiper-container">
                                <div class="swiper-wrapper">
                                   
                                    <div class="swiper-slide">
                                        <div class="card card-1">
                                            <div class="content">
                                                <div class="text">
                                                    <h3>Konservasi Lingkungan</h3>
                                                    <p>Menyoroti pentingnya penanaman pohon mangrove sebagai langkah
                                                        konservasi lingkungan. Menjelaskan manfaat ekosistem
                                                        mangrove dalam menjaga keanekaragaman hayati, melindungi
                                                        pesisir dari abrasi, dan menyimpan karbon.</p>
                                                </div>
                                                <img src="{{ url('/') }}/assets-web2/assets/images/nilai utama/01.png"
                                                    alt="">
                                            </div>
                                        </div>
                                    </div>

                                  
                                    <div class="swiper-slide">
                                        <div class="card card-2">
                                            <div class="content">
                                                <div class="text">
                                                    <h3>Edukasi</h3>
                                                    <p>Meningkatkan kesadaran masyarakat akan pentingnya pohon mangrove
                                                        dan dampak positifnya. Menyediakan informasi tentang ekologi
                                                        mangrove, manfaatnya bagi manusia dan lingkungan, serta cara
                                                        terlibat dalam kegiatan penanaman dan pemeliharaan mangrove.</p>
                                                </div>
                                                <img src="{{ url('/') }}/assets-web2/assets/images/nilai utama/02.png"
                                                    alt="">
                                            </div>
                                        </div>
                                    </div>

                                   
                                    <div class="swiper-slide">
                                        <div class="card card-3">
                                            <div class="content">
                                                <div class="text">
                                                    <h3>Kolaborasi dan Partisipasi</h3>
                                                    <p>Mendorong kolaborasi dengan komunitas lokal, pemerintah, dan
                                                        organisasi lingkungan untuk memperkuat upaya penanaman pohon
                                                        mangrove. Memotivasi orang-orang untuk bergabung, menjadi
                                                        sukarelawan, atau menyumbangkan dana untuk mendukung proyek
                                                        penanaman mangrove.</p>
                                                </div>
                                                <img src="{{ url('/') }}/assets-web2/assets/images/nilai utama/03.png"
                                                    alt="">
                                            </div>
                                        </div>
                                    </div>
                                   
                                    <div class="swiper-slide">
                                        <div class="card card-4">
                                            <div class="content">
                                                <div class="text">
                                                    <h3>Proyek Penanaman Mangrove</h3>
                                                    <p>Menampilkan informasi tentang proyek-proyek penanaman pohon
                                                        mangrove yang sedang berjalan atau telah selesai. Menampilkan
                                                        foto dan cerita sukses tentang bagaimana pohon mangrove telah
                                                        mengubah lingkungan setempat.</p>
                                                </div>
                                                <img src="{{ url('/') }}/assets-web2/assets/images/nilai utama/04.png"
                                                    alt="">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="swiper-pagination"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> --}}

    <section class="card-informasi">
        <div class="achievement-title" style="width: 400px; margin: 0 auto; text-align: center;">
            <h3>Informasi</h3>
            <p
                style="font-weight: 300; font-size: 16px; line-height: 24px; text-align: center; letter-spacing: -.011em; color: #696969;">
                Informasi yang membuka pintu bagi pemahamanmu mengenai hal-hal penting yang ada
                di wbsite ini.</p>
        </div>
        <br>
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-4">
                    <div class="container container-card">
                        <a class="card1" href="{{ url('Katalog-Pohon') }}">
                            <label>Katalog Pohon</label>
                            <p class="small">Jelajahi Katalog-Pohon sekarang dan temukan keindahan serta manfaat tak
                                ternilai dari pohon-pohon mangrove di sekitar kita. </p>
                            <div class="go-corner" href="#">
                                <div class="go-arrow">
                                    →
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="container container-card">
                        <a class="card1" href="{{ url('Event') }}">
                            <label>Event</label>
                            <p class="small"> Dapatkan pengalaman tak terlupakan sambil berkontribusi langsung pada
                                keberlanjutan lingkungan. Ayo, jadilah bagian dari perubahan positif melalui Event
                                Penanaman
                                Mangrove!</p>
                            <div class="go-corner" href="#">
                                <div class="go-arrow">
                                    →
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="container container-card">
                        <a class="card1" href="{{ url('Lokasi-Penanaman') }}">
                            <label>Lokasi</label>
                            <p class="small">Jelajahi Keberhasilan Penanaman Mangrove! Temukan keindahan ekosistem
                                pantai
                                yang dipulihkan melalui penanaman mangrove.</p>
                            <div class="go-corner" href="{{ url('Lokasi-Penanamn') }}">
                                <div class="go-arrow">
                                    →
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="maps">
        <div class="shop-page" style="margin-bottom:150px;margin-top:150px">
            <div class="container">
                <div class="section-wrapper">
                    <div class="row justify-content-center">
                        <div class="achievement-title" style="margin: 0 auto; text-align: center;">
                            <h3>Lokasi Event dan Penanaman</h3>
                        </div>
                        <div class="col-md-12">
                            <div class="card  mt-2" style="border:1px solid #075741">
                                <div class="card-body">
                                    <div id="map-container" class="position-relative">
                                        <div id="map" class="banner-style-2"></div>
                                    </div>
                                    <div class="mt-2" style="text-align: center; margin-bottom:-15px">
                                        <a href="{{ url('Peta') }}" class="btn btn-sm"
                                            style="background-color: #064635; color: white;"><i
                                                class="icofont-search-map"></i> Jelajahi Peta</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <style>
        #map-container {
            position: relative;
        }

        #map {
            height: 65vh;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        #map-overlay {
            position: absolute;
            top: 5%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(7, 80, 37, 0.61);
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
            height: 25px;
        }

        .overlay-text {
            color: white;
            font-size: 16px;
            text-align: center;
            margin: 0;
        }

        .card.card-1 {
            border-radius: 20px;
            padding: 20px;
            color: #fff;
            display: flex;
            background-color: #43936C;
            height: 400px;
        }

        .card-1 .content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-1 .text {
            width: 50%;
            margin-left: 100px;
            margin-top: 80px;
        }

        .card-1 img {
            margin-right: 50px;
            margin-top: 50px;
            width: 400px;
            height: 250px;
            object-fit: cover;
            border-radius: 20px;
        }

        .card.card-2 {
            border-radius: 10px;
            padding: 20px;
            color: #fff;
            display: flex;
            background-color: #3181B6;
            height: 400px;
        }

        .card-2 .content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-2 .text {
            width: 50%;
            margin-left: 100px;
            margin-top: 80px;
        }

        .card-2 img {
            margin-right: 50px;
            margin-top: 50px;
            width: 400px;
            height: 250px;
            object-fit: cover;
            border-radius: 20px;
        }

        .card.card-3 {
            border-radius: 10px;
            padding: 20px;
            color: #fff;
            display: flex;
            background-color: #CA6634;
            height: 400px;
        }

        .card-3 .content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-3 .text {
            width: 50%;
            margin-left: 100px;
            margin-top: 80px;
        }

        .card-3 img {
            margin-right: 50px;
            margin-top: 50px;
            width: 400px;
            height: 250px;
            object-fit: cover;
            border-radius: 20px;
        }

        .card.card-4 {
            border-radius: 10px;
            padding: 20px;
            color: #fff;
            display: flex;
            background-color: #CB344C;
            height: 400px;
        }

        .card-4 .content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-4 .text {
            width: 50%;
            margin-left: 100px;
            margin-top: 80px;
        }

        .card-4 img {
            margin-right: 50px;
            margin-top: 50px;
            width: 400px;
            height: 250px;
            object-fit: cover;
            border-radius: 20px;
        }

        .text h3 {
            color: #fff;
        }

        .text p {
            color: #fff;
        }


        .container.container-card {
            width: 100%;
            height: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        label {
            color: #262626;
            font-size: 17px;
            line-height: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        p {
            font-size: 17px;
            font-weight: 400;
            line-height: 20px;
            color: #000000;

            &.small {
                font-size: 14px;
            }
        }

        .go-corner {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            width: 32px;
            height: 32px;
            overflow: hidden;
            top: 0;
            right: 0;
            background-color: #075741;
            border-radius: 0 4px 0 32px;
        }

        .go-arrow {
            margin-top: -4px;
            margin-right: -4px;
            color: white;
            font-family: courier, sans;
        }

        .card1 {
            display: block;
            position: relative;
            background-color: #f2f8f9;
            border-radius: 4px;
            padding: 32px 24px;
            margin: 12px;
            text-decoration: none;
            z-index: 0;
            overflow: hidden;

            &:before {
                content: "";
                position: absolute;
                z-index: -1;
                top: -16px;
                right: -16px;
                background: #075741;
                height: 32px;
                width: 50px;
                border-radius: 32px;
                transform: scale(1);
                transform-origin: 50% 50%;
                transition: transform 0.25s ease-out;
            }

            &:hover:before {
                transform: scale(21);
            }
        }

        .card1:hover p {
            transition: all 0.3s ease-out;
            color: rgba(255, 255, 255, 0.8);
        }

        .card1:hover label {
            transition: all 0.3s ease-out;
            color: #ffffff;
        }

        .maps {
            position: relative;
            z-index: 5;
        }

        @media only screen and (max-width: 575.99px) {
            .card-1 .text {
                width: 100%;
                margin-left: 0;
                margin-top: 0;
                z-index: 1;
                position: relative;

            }

            .card-1 img {
                position: absolute;
                bottom: 25px;
                left: auto;
                right: auto;
                height: 100px;
                width: 300px;
            }

            .card-2 .text {
                width: 100%;
                margin-left: 0;
                margin-top: 0;
                z-index: 1;
                position: relative;
            }

            .card-2 img {
                position: absolute;
                bottom: 25px;
                left: auto;
                right: auto;
                height: 100px;
                width: 300px;
            }

            .card-3 .text {
                width: 100%;
                margin-left: 0;
                margin-top: 0;
                z-index: 1;
                position: relative;

            }

            .card-3 img {
                position: absolute;
                bottom: 25px;
                left: auto;
                right: auto;
                height: 100px;
                width: 300px;
            }

            .card-4 .text {
                width: 100%;
                margin-left: 0;
                margin-top: 0;
                z-index: 1;
                position: relative;

            }

            .card-4 img {
                position: absolute;
                bottom: 25px;
                left: auto;
                right: auto;
                height: 100px;
                width: 300px;
            }

            #map-overlay {
                display: none;
            }

            .overlay-text {
                display: none;
            }
        }
    </style>
    @push('style')
        <!-- leaflet start -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
            integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
        <link rel="stylesheet" type="text/css" href="{{ url('/') }}/assets-web2/assets/css/leaflet.defaultextent.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
        <!-- leaflet end -->
        <!-- Marker Cluster -->
        <link rel="stylesheet" href="{{ url('/') }}/assets-sig/assets/css/MarkerCluster.Default.css" />
        <link rel="stylesheet" href="{{ url('/') }}/assets-sig/assets/css/MarkerCluster.css" />
    @endpush
    @push('script')
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
            integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
        <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
        <script src="{{ url('/') }}/assets-web2/assets/js/leaflet.defaultextent.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        {{-- marker cluster --}}
        <script src="{{ url('/') }}/assets-sig/assets/js/leaflet.markercluster.js"></script>
        <script src="https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js"></script>
    @endpush
</x-web.app-web>
<script>
    var swiper = new Swiper('.swiper-container', {
        autoplay: {
            delay: 3000,
        },
        loop: true,
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
            renderBullet: function(index, className) {
                return '<span class="' + className + '" style="background-color: white;"></span>';
            },
        },
    });

    var map;
    var markers = L.markerClusterGroup();

    var LokasiMarkersData = [];
    @foreach ($list_lokasi as $lokasi)
        LokasiMarkersData.push({
            lokasi_id: "{{ $lokasi->id }}",
            lat: {{ $lokasi->lat }},
            lng: {{ $lokasi->lng }},
            title: "{{ $lokasi->nama_lokasi }}",
            alamat: "{{ $lokasi->alamat_lokasi }}",
            foto: "{{ $lokasi->foto_lokasi }}",
            jumlahEvent: "{{ $lokasi->events()->count() }}",
            jumlahPohon: "{{ $lokasi->total_pohon_ditanam }}",
        });
    @endforeach

    var EventMarkersData = [];
    @foreach ($list_event as $event)
        @php
            // Hitung status acara
            $now = \Carbon\Carbon::now();
            $tanggal_event = \Carbon\Carbon::parse($event->tanggal_event);
            $tanggal_selesai = \Carbon\Carbon::parse($event->tanggal_selesai);
            $status = '';
            $statusClass = '';

            if ($now->gt($tanggal_selesai)) {
                $status = 'Selesai';
                $statusClass = 'text-danger';
            } elseif ($now->between($tanggal_event, $tanggal_selesai)) {
                $status = 'Berlangsung';
                $statusClass = 'text-primary';
            } else {
                $status = 'Aktif';
                $statusClass = 'text-success';
            }
        @endphp
        EventMarkersData.push({
            event_id: "{{ $event->id }}",
            lat: {{ $event->lat }},
            lng: {{ $event->lng }},
            foto: "{{ $event->foto }}",
            title: "{{ $event->nama_event }}",
            lokasi_id: "{{ $event->lokasi_id ? $event->lokasi_id : 'Tidak tersedia' }}",
            lokasi: "{{ $event->lokasi ? $event->lokasi->nama_lokasi : 'Lokasi tidak tersedia' }}",
            pohonDitanam: "{{ $event->tanaman_event->jumlah_pohon }}",
            status: "{{ $status }}",
            statusClass: "{{ $statusClass }}"
        });
    @endforeach

    // Custom icon untuk lokasi
    var greenIcon = L.icon({
        iconUrl: '{{ url('/') }}/assets-sig/assets/icon/lokasi.png',
        iconSize: [32, 35],
        iconAnchor: [16, 32],
        className: 'marker-custom'
    });
    // Custom icon untuk penanaman
    var redIcon = L.icon({
        iconUrl: '{{ url('/') }}/assets-sig/assets/icon/event.png',
        iconSize: [32, 35],
        iconAnchor: [16, 32]
    });

    function initMap() {
        // Membuat peta
        map = new L.Map('map', {
            fullscreenControl: true,
            fullscreenControlOptions: {
                position: 'topright'
            }
        });

        // Menambahkan tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Bayu Pratama'
        }).addTo(map);

        // Tentukan koordinat pusat peta untuk desktop
        var desktopCenter = [-1.790597, 110.410990];
        // Tentukan koordinat pusat peta untuk mobile
        var mobileCenter = [-1.790597, 110.410990]; // Sesuaikan dengan koordinat yang sesuai untuk mobile

        // Tentukan zoom level untuk desktop dan mobile
        var desktopZoom = 9;
        var mobileZoom = 8; // Sesuaikan dengan zoom level yang sesuai untuk mobile

        // Tentukan tinggi elemen mobile-header
        var mobileHeaderHeight = $('.mobile-header').outerHeight() || 0;

        // Tentukan apakah perangkat saat ini adalah mobile
        var isMobile = $(window).width() <= 768;

        // Tentukan koordinat pusat dan zoom level berdasarkan ukuran layar
        var center = isMobile ? mobileCenter : desktopCenter;
        var zoomLevel = isMobile ? mobileZoom : desktopZoom;

        // Set view pada peta
        map.setView(center, zoomLevel);


        LokasiMarkersData.forEach(function(markerData) {
            var marker = L.marker([markerData.lat, markerData.lng], {
                icon: greenIcon,
                tags: [markerData.tags]
            });

            marker.bindPopup(`
                <div class="popup-content" style="max-height: 200px; overflow-y: auto; width: 250px; padding-right:10px">
                    <label style="color: black; font-weight: bolder; display: flex; align-items: center; justify-content: center;">Detail Lokasi</label>
                    <div class="modal-content">
                        <img src="${markerData.foto}" style="width: 100%; height: auto; border-radius: 5px; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border: 1px solid #00947c;" class="image" loading="lazy" />
                    </div>
                    <table class="table table-bordered table-sm mt-2">
                        <tbody>
                            <tr>
                                <td>Lokasi</td>
                                <td style="text-align: justify">${markerData.title}</td>
                            </tr>
                            <tr>
                                <td>Alamat</td>
                                <td style="text-align: justify">${markerData.alamat}</td>
                            </tr>
                            <tr>
                                <td>Jumlah Event</td>
                                <td style="text-align: justify">${markerData.jumlahEvent}</td>
                            </tr>
                            <tr>
                                <td>Pohon Ditanam</td>
                                <td style="text-align: justify">${markerData.jumlahPohon}</td>
                            </tr>
                        </tbody>
                    </table>
                    <a href="{{ url('Lokasi-Penanaman') }}/${markerData.lokasi_id}/${markerData.title}" class="btn btn-green btn-sm float-right" style="color:white">Detail Lokasi</a>
                </div>
            `, {
                offset: [0, -25] // Atur offset horizontal dan vertikal
            });

            markers.addLayer(marker); // Tambahkan marker ke dalam marker cluster
        });

        EventMarkersData.forEach(function(markerData) {
            var marker = L.marker([markerData.lat, markerData.lng], {
                icon: redIcon,
                tags: [markerData.tags]
            });

            marker.bindPopup(`
                <div class="popup-content" style="max-height: 200px; overflow-y: auto; width: 250px; padding-right:10px">
                    <label style="color: black; font-weight: bolder; display: flex; align-items: center; justify-content: center;">Detail Event</label>
                    <div class="modal-content">
                        <img src="${markerData.foto}" style="width: 100%; height: auto; border-radius: 5px; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border: 1px solid #00947c;" class="image" loading="lazy" />
                    </div>
                    <table class="table table-bordered table-sm mt-2">
                        <tbody>
                            <tr>
                                <td>Nama Event</td>
                                <td style="text-align: justify">${markerData.title}</td>
                            </tr>
                            <tr>
                                <td>Lokasi</td>
                                <td style="text-align: justify">${markerData.lokasi}</td>
                            </tr>
                            <tr>
                                <td>Pohon Ditanam</td>
                                <td style="text-align: justify">${markerData.pohonDitanam}</td>
                            </tr>
                            <tr>
                                <td>Status</td>
                                <td style="text-align: justify" class="${markerData.statusClass}">${markerData.status}</td>
                            </tr>
                        </tbody>
                    </table>
                    <a href="{{ url('Event') }}/${markerData.event_id}" class="btn btn-green btn-sm float-right" style="color:white">Detail Event</a>
                </div>
            `, {
                offset: [0, -25] // Atur offset horizontal dan vertikal
            });

            markers.addLayer(marker); // Tambahkan marker ke dalam marker cluster

            // var polyline = L.polyline(latlngs, {
            //     color: 'blue',
            //     weight: 1.5
            // }).addTo(map);
        });

        map.addLayer(markers); // Tambahkan marker cluster ke dalam peta
        // map.fitBounds(markers.getBounds());

        //shape awalan seluruh ketapang
        $.getJSON('{{ url('/') }}/assets-sig/assets/Ketapang.geojson', function(json) {
            geoLayer = L.geoJson(json, {
                style: function(feature) {
                    return {
                        fillOpacity: 0.6,
                        weight: 1,
                        opacity: 1,
                        color: '#44A688'
                    };
                },
                onEachFeature: function(fetaure, layer) {
                    layer.addTo(map);
                }
            });
        });

        L.control.resetView({
            position: "topright",
            title: "Reset view",
            latlng: L.latLng([-1.790597, 110.410990]),
            zoom: zoomLevel,
        }).addTo(map);

        // Legend
        L.control.Legend({
            className: "legend-custom",
            position: "bottomright",
            legends: [{
                    label: ": Lokasi",
                    type: "image",
                    url: "{{ url('/') }}/assets-sig/assets/icon/lokasi.png",
                },
                {
                    label: ": Event",
                    type: "image",
                    url: "{{ url('/') }}/assets-sig/assets/icon/event.png",
                },
            ]
        }).addTo(map);
    }

    // Fungsi untuk menambahkan marker dengan SVG ke peta dan menghapusnya setelah 5 detik
    function addTemporaryMarker(map, lat, lng) {
        // Definisikan SVG dan buat ikon menggunakan L.divIcon
        var svg =
            '<svg pointer-events="none" class="leaflet-marker-icon bounce-marker" width="24" height="24" viewBox="0 0 24 24" fill="#000000" style="z-index-1"><circle cx="12" cy="12" r="10" stroke="#e03" stroke-width="3" fill="none"></circle></svg>';
        var icon = L.divIcon({
            className: 'custom-marker',
            html: svg,
            iconAnchor: [12, 10]
        });

        // Tambahkan marker ke peta
        var marker = L.marker([lat, lng], {
            icon: icon
        }).addTo(map);

        // Gunakan setTimeout untuk menghapus marker setelah 5 detik (5000 ms)
        setTimeout(function() {
            map.removeLayer(marker);
        }, 8000);
    }

    // Panggil fungsi addTemporaryMarker ketika peta diinisialisasi atau saat Anda memerlukannya
    window.onload = function() {
        initMap();

        // Contoh penggunaan: tambahkan marker sementara di posisi tertentu
        addTemporaryMarker(map, -1.790597, 110.410990);
    };

    window.onload = function() {
        initMap();
        var marker;

        $('#lokasi-select').change(function() {
            // Hapus marker sebelumnya jika ada
            if (marker) {
                map.removeLayer(marker);
            }

            // Dapatkan nilai lat dan lng dari opsi yang dipilih
            var selectedOption = $(this).find('option:selected');
            var lat = parseFloat(selectedOption.data('lat'));
            var lng = parseFloat(selectedOption.data('lng'));

            // Panggil fungsi addTemporaryMarker dengan koordinat yang dipilih
            addTemporaryMarker(map, lat, lng);
            // Gunakan metode flyTo untuk mengarahkan peta ke lokasi marker yang sesuai
            map.flyTo([lat, lng], 20, {
                animate: true,
                duration: 5,
                easeLinearity: 1,
                noMoveStart: true
            });

            // var svg =
            //     '<svg pointer-events="none" class="leaflet-marker-icon bounce-marker" width="24" height="24" viewBox="0 0 24 24" fill="#000000" style="z-index-1"><circle cx="12" cy="12" r="10" stroke="#e03" stroke-width="3" fill="none"></circle></svg>';
            // var icon = L.divIcon({
            //     className: 'custom-marker',
            //     html: svg,
            //     iconAnchor: [12, 10]
            // });

            marker = L.marker([lat, lng], {
                icon: icon
            }).addTo(map);


            marker.bringToBack();
        });
    };

    $(document).ready(function() {
        // Inisialisasi select2 pada elemen select
        $('.select2').select2();

        // Panggil fungsi resizeMap saat halaman dimuat dan setiap kali jendela diubah ukurannya
        resizeMap();
        $(window).resize(resizeMap);

        // Fungsi untuk mengubah ukuran peta sesuai dengan tinggi viewport
        function resizeMap() {
            var headerHeight = $('header').outerHeight() || 0;
            var mobileHeaderHeight = $('.mobile-header').outerHeight() || 0;
            var viewportHeight = $(window).height();
            var isMobile = $(window).width() <= 768;

            // Jika di mobile, sesuaikan tinggi dengan mobile-header, selain itu sesuaikan dengan header
            var mapHeight = isMobile ? viewportHeight - mobileHeaderHeight : viewportHeight - headerHeight;

            $('#map').css('height', mapHeight + 'px');
        }
    });
</script>
